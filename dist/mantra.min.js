'use strict';(function(h) {
  var c = h.Mantra = {};
  c.e = h.document;
  c.define = function(a, b) {
    var d = c, e = b.hasOwnProperty("constructor") && "function" == typeof b.constructor ? b.constructor : !1, g = "string" == typeof b.extend ? c.resolve(b.extend) : b.extend;
    if(e) {
      var h = e, e = function() {
        h.apply(this, arguments)
      };
      if(g) {
        var k = function() {
        };
        k.prototype = g.prototype;
        e.prototype = new k;
        e.prototype.constructor = e;
        e.prototype.superconstructor = g;
        e.prototype.superclass = g.prototype
      }
      var g = e.prototype, f;
      for(f in b) {
        b.hasOwnProperty(f) && ("constructor" != f && "statics" != f) && (g[f] = b[f])
      }
      e.prototype.singleton && !e.prototype.hasOwnProperty("abstract") && (e = new e)
    }
    a = a.split(".");
    "Mantra" == a[0] && a.shift();
    f = 0;
    for(g = a.length;f < g;f++) {
      k = a[f], d[k] || (d[k] = f == g - 1 && e ? e : {}), d = d[k]
    }
    if(e = e ? b.statics : b) {
      for(var l in e) {
        e.hasOwnProperty(l) && (d[l] = e[l])
      }
    }
    return d
  };
  c.resolve = function(a) {
    var b = c;
    a = a.split(".");
    "Mantra" == a[0] && a.shift();
    for(var d = 0, e = a.length;d < e && !(b = b[a[d]], !b);d++) {
    }
    return b
  };
  c.relayMethod = function(a, b, d) {
    if(d) {
      a[d] = b[d].bind(b)
    }else {
      for(d in b) {
        b.hasOwnProperty(d) && "function" == typeof b[d] && c.relayMethod(a, b, d)
      }
    }
  };
  c.define("Mantra.utils.NodeStore", {constructor:function(a, b) {
    this.target = a;
    this.id = b;
    this.d = {}
  }, get:function(a) {
    return this.d[a]
  }, set:function(a, b) {
    return this.d[a] = b
  }, remove:function(a) {
    var b = this.get(a);
    delete this.d[a];
    return b
  }, statics:{f:{}, l:{}, k:0, getStore:function(a) {
    var b = a._mid, d;
    void 0 === b && (a._mid = b = this.k++, this.l[b] = a);
    (d = this.f[b]) || (d = this.f[b] = new c.utils.NodeStore(a, b));
    return d
  }}});
  c.relayMethod(c, c.utils.NodeStore, "getStore");
  c.define("Mantra.gestures", {n:h.navigator.s || h.navigator.msPointerEnabled, h:"ontouchstart" in h, i:/mobile|tablet|ip(ad|hone|od)|android/i, o:this.h && h.navigator.userAgent.match(this.i), p:"mouse", r:"touch", q:"pen"});
  c.define("Mantra.gestures.Dispecher", {singleton:!0, constructor:function() {
    this.b = this.b.bind(this)
  }, a:{}, c:0, register:function(a) {
    a instanceof c.gestures.Gesture || ("string" == typeof a && (a = c.resolve(a)), a = new a);
    this.a[a.name] = {gesture:a, g:0}
  }, on:function(a, b, d) {
    this.a[a] && (b = c.getStore(b), (b.get(a) || b.set(a, [])).push(d), this.c++, this.a[a].g++, 1 == this.c && this.j())
  }, off:function(a, b, d) {
    if(this.a[a]) {
      b = c.getStore(b);
      var e;
      e = b.get(a);
      d = e.indexOf(d);
      -1 < d && (b.set(a, e.splice(d, 1)), this.c--, this.a[a].g--, 0 === this.c && this.m())
    }
  }, j:function() {
    c.e.addEventListener("touchstart", this.b, !1)
  }, m:function() {
    c.e.removeEventListener("touchstart", this.b, !1)
  }, b:function(a) {
    console.log(a)
  }, statics:{}});
  c.relayMethod(c, c.gestures.Dispecher, "on");
  c.relayMethod(c, c.gestures.Dispecher, "off");
  c.relayMethod(c, c.gestures.Dispecher, "register");
  c.define("Mantra.gestures.Gesture", {singleton:!0, "abstract":!0, name:null, constructor:function() {
    this.name && c.gestures.Dispecher.register(this)
  }, statics:{}});
  c.define("Mantra.gestures.Tap", {extend:"Mantra.gestures.Gesture", name:"tap", constructor:function() {
    this.superconstructor.apply(this)
  }})
}).call(this, window);

