'use strict';(function(h) {
  var b = h.Mantra = {t:h.navigator.z || h.navigator.msPointerEnabled, j:"ontouchstart" in h, o:/mobile|tablet|ip(ad|hone|od)|android/i, p:this.j && h.navigator.userAgent.match(this.o), u:"mouse", w:"touch", v:"pen", a:"start", d:"move", c:"end"};
  b.i = h.document;
  b.define = function(a, c) {
    c || (c = {});
    var d = b, e = c.hasOwnProperty("constructor") && "function" == typeof c.constructor ? c.constructor : !1, f = "string" == typeof c.extend ? b.resolve(c.extend) : c.extend;
    if(e) {
      var h = e, e = function() {
        h.apply(this, arguments)
      };
      if(f) {
        var k = function() {
        };
        k.prototype = f.prototype;
        e.prototype = new k;
        e.prototype.constructor = e;
        e.prototype.superconstructor = f;
        e.prototype.superclass = f.prototype
      }
      var f = e.prototype, g;
      for(g in c) {
        c.hasOwnProperty(g) && ("constructor" != g && "statics" != g) && (f[g] = c[g])
      }
      e.prototype.singleton && !e.prototype.hasOwnProperty("abstract") && (e = new e)
    }
    a = a.split(".");
    "Mantra" == a[0] && a.shift();
    g = 0;
    for(f = a.length;g < f;g++) {
      k = a[g], d[k] || (d[k] = g == f - 1 && e ? e : {}), d = d[k]
    }
    if(e = e ? c.statics : c) {
      for(var l in e) {
        e.hasOwnProperty(l) && (d[l] = e[l])
      }
    }
    return d
  };
  b.resolve = function(a) {
    var c = b;
    a = a.split(".");
    "Mantra" == a[0] && a.shift();
    for(var d = 0, e = a.length;d < e && !(c = c[a[d]], !c);d++) {
    }
    return c
  };
  b.relayMethod = function(a, c, d) {
    if(d) {
      a[d] = c[d].bind(c)
    }else {
      for(d in c) {
        c.hasOwnProperty(d) && "function" == typeof c[d] && b.relayMethod(a, c, d)
      }
    }
  };
  b.define("Mantra.utils.NodeStore", {constructor:function(a, b) {
    this.target = a;
    this.id = b;
    this.h = {}
  }, get:function(a) {
    return this.h[a]
  }, set:function(a, b) {
    return this.h[a] = b
  }, remove:function(a) {
    var b = this.get(a);
    delete this.h[a];
    return b
  }, statics:{l:{}, s:{}, r:0, getStore:function(a) {
    var c = a._mid, d;
    void 0 === c && (a._mid = c = this.r++, this.s[c] = a);
    (d = this.l[c]) || (d = this.l[c] = new b.utils.NodeStore(a, c));
    return d
  }}});
  b.relayMethod(b, b.utils.NodeStore, "getStore");
  b.define("Mantra.gestures");
  b.define("Mantra.gestures.Dispatcher", {singleton:!0, constructor:function() {
    this.f = this.f.bind(this);
    this.q()
  }, b:{}, g:0, q:function() {
    var a = {};
    b.j && (b.p ? (a[b.a] = "touchstart", a[b.d] = "touchmove", a[b.c] = "touchend touchcancel") : (a[b.a] = "touchstart mousedown", a[b.d] = "touchmove mousemove", a[b.c] = "touchend touchcancel mouseup"));
    b.e = a
  }, register:function(a) {
    a instanceof b.gestures.Gesture || ("string" == typeof a && (a = b.resolve(a)), a = new a);
    this.b[a.name] = {gesture:a, n:0}
  }, on:function(a, c, d) {
    if(this.b[a]) {
      var e = b.getStore(c);
      (e.get(a) || e.set(a, [])).push(d);
      this.g++;
      this.b[a].n++;
      a = e.get("detecting") || 0;
      e.set("detecting", a++);
      1 == a && this.k(b.e[b.a], c);
      1 == this.g && this.k(b.e[b.d] + " " + b.a[b.c])
    }
  }, off:function(a, c, d) {
    if(this.b[a]) {
      var e = b.getStore(c), f;
      f = e.get(a);
      d = f.indexOf(d);
      -1 < d && (e.set(a, f.splice(d, 1)), this.g--, this.b[a].n--, a = e.get("detecting"), e.set("detecting", a--), a || this.m(b.e[b.a], c), 0 === this.g && this.m(b.e[b.d] + " " + b.a[b.c]))
    }
  }, k:function(a, c) {
    var d, e;
    a = a.split(" ");
    c || (c = b.i);
    d = 0;
    for(e = a.length;d < e;d++) {
      c.addEventListener(a[d], this.f, !1)
    }
  }, m:function(a, c) {
    var d, e;
    a = a.split(" ");
    c || (c = b.i);
    d = 0;
    for(e = a.length;d < e;d++) {
      c.removeEventListener(a[d], this.f, !1)
    }
  }, f:function(a) {
    console.log(a.type)
  }, statics:{}});
  b.relayMethod(b, b.gestures.Dispatcher, "on");
  b.relayMethod(b, b.gestures.Dispatcher, "off");
  b.relayMethod(b, b.gestures.Dispatcher, "register");
  b.define("Mantra.gestures.Gesture", {singleton:!0, "abstract":!0, name:null, constructor:function() {
    this.name && b.gestures.Dispecher.register(this)
  }, statics:{}});
  b.define("Mantra.gestures.Tap", {extend:"Mantra.gestures.Gesture", name:"tap", constructor:function() {
    this.superconstructor.apply(this)
  }})
}).call(this, window);

